import { jsx as l } from "../../../../external/preact/jsx-runtime/dist/jsxRuntime.module.js";
import M from "../../../../core/Context/useCoreContext.js";
import { useState as R, useRef as y, useCallback as a, useMemo as N, useEffect as O } from "../../../../external/preact/hooks/dist/hooks.module.js";
import { UploadedFile as T } from "./components/UploadedFile.js";
import { Dropzone as b } from "./components/Dropzone.js";
import { validationErrors as i, BASE_CLASS as g } from "./constants.js";
/* empty css               */
import { fixedForwardRef as w } from "../../../../utils/preact/fixedForwardRef.js";
import { isFunction as Y } from "../../../../utils/value/is.js";
const G = w(({ onChange: n, mapError: m, onDelete: u, ...f }, I) => {
  const [r, d] = R([]), p = y(r), c = r[0], { i18n: e } = M(), { disabled: s } = f, L = a(
    (t) => {
      switch (t) {
        case i.DISALLOWED_FILE_TYPE:
          return e.get("common.inputs.file.errors.disallowedType");
        case i.FILE_REQUIRED:
          return e.get("common.inputs.file.errors.required");
        case i.TOO_MANY_FILES:
          return e.get("common.inputs.file.errors.tooMany");
        case i.VERY_LARGE_FILE:
          return e.get("common.inputs.file.errors.tooLarge");
        case i.MAX_DIMENSIONS:
          return e.get("common.inputs.file.errors.maxDimensions");
      }
      return "";
    },
    [e]
  ), _ = N(() => Y(m) ? m : L, [m]), S = a(
    (t) => {
      s || (d((o) => {
        const E = o.findIndex((A) => A === t);
        if (E < 0)
          return o;
        const [...F] = o;
        return F.splice(E, 1), F;
      }), u == null || u());
    },
    [s, u]
  ), x = a(
    (t) => {
      s || d((o) => o.length === 0 && t.length === 0 ? o : t);
    },
    [s]
  );
  return O(() => {
    p.current !== r && (p.current = r, n == null || n([...r]));
  }, [r, n]), /* @__PURE__ */ l("div", {
    className: g,
    // prettier-ignore
    children: c ? /* @__PURE__ */ l(T, { disabled: s, file: c, deleteFile: () => S(c) }) : /* @__PURE__ */ l(b, { ...f, ref: I, mapError: _, uploadFiles: x })
  });
});
export {
  G as FileInput,
  G as default
};
