import { useState as m, useRef as A, useMemo as D, useCallback as q, useEffect as x } from "../external/preact/hooks/dist/hooks.module.js";
import { InteractionKeyCode as I } from "../components/types.js";
import { useUniqueId as w } from "./useUniqueId.js";
const O = (t) => (t == null ? void 0 : t.disabled) === !0, a = (t, u, c) => {
  const s = t.length;
  if (s) {
    let r = u, i = s;
    for (; i--; ) {
      for (; r < 0; ) r += s;
      if (r >= s && (r %= s), !O(t[r])) return r;
      r += c;
    }
  }
  return 0;
}, T = (t, u, c = 0) => {
  if (!u) return c;
  const s = t.findIndex((f) => f.id === u), r = s === -1 ? c : s, i = a(
    t,
    r,
    1
    /* FORWARD */
  );
  return r === i ? r : c;
}, N = ({
  options: t,
  activeOption: u,
  onChange: c
}) => {
  const [s, r] = m(!1), [i, f] = m(T(t, u)), o = t[i], R = A(o), d = A([]), b = w(), v = D(() => {
    const e = [];
    for (let n = 0; n < t.length; n++)
      e[n] = (l) => d.current[n] = l;
    return e;
  }, [t]), y = q((e) => {
    const n = d.current.findIndex((l) => l === e.currentTarget);
    O(d.current[n]) || (e.preventDefault(), f(n));
  }, []), E = D(() => {
    const e = {
      [I.ARROW_LEFT]: () => f((n) => a(
        d.current,
        n - 1,
        -1
        /* BACKWARD */
      )),
      [I.ARROW_RIGHT]: () => f((n) => a(
        d.current,
        n + 1,
        1
        /* FORWARD */
      )),
      [I.HOME]: () => f(a(
        d.current,
        0,
        1
        /* FORWARD */
      )),
      [I.END]: () => f(a(
        d.current,
        -1,
        -1
        /* BACKWARD */
      ))
    };
    return (n) => {
      var l;
      e[n.key] && (n.preventDefault(), (l = e[n.key]) == null || l.call(e), r(!0));
    };
  }, []);
  return x(() => {
    f((e) => T(t, u, e));
  }, [t, u]), x(() => {
    if (s) {
      const e = d.current[i];
      O(e) || e == null || e.focus(), r(!1);
    }
  }, [i, s]), x(() => {
    R.current !== o && (R.current = o, c == null || c(o));
  }, [o, c]), { activeIndex: i, onClick: y, onKeyDown: E, refs: v, uniqueId: b };
};
export {
  N as default,
  N as useTabbedControl
};
