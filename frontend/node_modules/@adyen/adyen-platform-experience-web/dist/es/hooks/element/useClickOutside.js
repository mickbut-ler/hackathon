import { useRef as O, useCallback as c, useEffect as L } from "../../external/preact/hooks/dist/hooks.module.js";
import { popoverUtil as d } from "../../components/internal/Popover/utils/popoverUtil.js";
import R from "../useReflex.js";
const p = Symbol("__control.Elem.");
var h = /* @__PURE__ */ ((o) => (o.POPOVER = "POPOVER", o.DEFAULT = "DEFAULT", o))(h || {});
const v = (o) => o.stopImmediatePropagation(), _ = (o, s, f, u) => {
  const e = O(null), m = O(!1), l = c(
    (n) => {
      if (!(e && e.current)) return;
      const r = n.composedPath();
      if (u === "POPOVER")
        d.closePopoversOutsideOfClick(r);
      else {
        let P = 0, a = !1, t = r[P];
        for (; t instanceof Element && !(a || (a = t == null ? void 0 : t.isSameNode(e.current))); )
          t = r[++P] ?? t.parentElement, (t == null ? void 0 : t[p]) instanceof Element && (t = t[p], r.length = 0);
        s && !a && s(!0);
      }
    },
    [e, s, u]
  ), i = c(
    (n) => {
      e && e.current && (m.current = e.current.contains(n.target));
    },
    [e]
  ), E = c(
    (n) => {
      if (m.current) {
        m.current = !1;
        return;
      }
      l(n);
    },
    [l]
  );
  return L(() => {
    if (!f)
      return document.addEventListener("mousedown", i, !0), document.addEventListener("click", E, !0), u === "POPOVER" && e.current instanceof Element && d.add(e.current, s), () => {
        document.removeEventListener("mousedown", i, !0), document.removeEventListener("click", E, !0), e.current && d.remove(e.current);
      };
  }, [f, i, E, s, u, e]), R(
    c(
      (n, r) => {
        r instanceof Element && r.removeEventListener("focusout", v, !1), n instanceof Element && (f || (n.addEventListener("focusout", v, !1), e.current = n));
      },
      [f, u]
    ),
    o
  );
};
export {
  p as CONTROL_ELEMENT_PROPERTY,
  h as ClickOutsideVariant,
  _ as useClickOutside
};
